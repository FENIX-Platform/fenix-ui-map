define(["jquery","leaflet","hashmap"],function(__WEBPACK_EXTERNAL_MODULE_2__,__WEBPACK_EXTERNAL_MODULE_3__,__WEBPACK_EXTERNAL_MODULE_4__){return function(e){function t(i){if(a[i])return a[i].exports;var r=a[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){e.exports=a(1)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(jQuery){__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(2),__webpack_require__(3),__webpack_require__(4)],__WEBPACK_AMD_DEFINE_RESULT__=function($,L,HashMap){$.i18n={properties:function(e){},prop:function(e){return e.replace("_","")}};var FM={};return FM.CONFIG={BASEURL_LANG:"http://fenixrepo.fao.org/cdn/js/fenix-ui-map/0.1.4/i18n/",MAP_SERVICE_SHADED:"http://fenix.fao.org/test/geo/fenix/mapclassify/join/",DEFAULT_WMS_SERVER:"http://fenix.fao.org/demo/fenix/geoserver",MAP_SERVICE_GFI_JOIN:"http://fenix.fao.org/test/geo/fenix/mapclassify/request/",MAP_SERVICE_GFI_STANDARD:"http://fenix.fao.org/test/geo/fenix/mapclassify/request/",ZOOM_TO_BBOX:"http://fenix.fao.org/geo/fenix/spatialquery/db/spatial/bbox/layer/",CSS_TO_SLD:"http://fenixapps2.fao.org/geoservices/CSS2SLD",BASEURL_MAPS:"http://fenixapps2.fao.org/maps-demo",MAP_SERVICE_ZOOM_TO_BOUNDARY:"/rest/service/bbox",MAP_SERVICE_WMS_GET_CAPABILITIES:"/rest/service/request",MAP_SERVICE_PROXY:"/rest/service/request",LAYER_BOUNDARIES:"fenix:gaul0_line_3857",LAYER_LABELS:"http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png"},FMCONFIG=FM.CONFIG,FM.Class=function(){},FM.Class.extend=function(e){var t=function(){this.initialize&&this.initialize.apply(this,arguments),this._initHooks&&this.callInitHooks()},a=function(){};a.prototype=this.prototype;var i=new a;i.constructor=t,t.prototype=i;for(var r in this)this.hasOwnProperty(r)&&"prototype"!==r&&(t[r]=this[r]);e.statics&&(FM.extend(t,e.statics),delete e.statics),e.includes&&(FM.Util.extend.apply(null,[i].concat(e.includes)),delete e.includes),e.options&&i.options&&(e.options=FM.extend({},i.options,e.options)),FM.extend(i,e),i._initHooks=[];var o=this;return i.callInitHooks=function(){if(!this._initHooksCalled){o.prototype.callInitHooks&&o.prototype.callInitHooks.call(this),this._initHooksCalled=!0;for(var e=0,t=i._initHooks.length;e<t;e++)i._initHooks[e].call(this)}},t},FM.Class.include=function(e){FM.extend(this.prototype,e)},FM.Class.mergeOptions=function(e){FM.extend(this.prototype.options,e)},FM.Class.addInitHook=function(e){var t=Array.prototype.slice.call(arguments,1),a="function"==typeof e?e:function(){this[e].apply(this,t)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(a)},FM.Util={initializeLangProperties:function(e){var t="";switch(e){case"FR":t="fr";break;case"ES":t="es";break;default:t="en"}var a=FMCONFIG.BASEURL_LANG;$.i18n.properties({name:"I18N",path:a,mode:"both",language:t})},extend:function(e){var t,a,i,r,o=Array.prototype.slice.call(arguments,1);for(a=0,i=o.length;a<i;a++){r=o[a]||{};for(t in r)r.hasOwnProperty(t)&&(e[t]=r[t])}return e},bind:function(e,t){var a=arguments.length>2?Array.prototype.slice.call(arguments,2):null;return function(){return e.apply(t,a||arguments)}},stamp:function(){var e=0,t="_leaflet_id";return function(a){return a[t]=a[t]||++e,a[t]}}(),limitExecByInterval:function(e,t,a){var i,r;return function o(){var n=arguments;return i?void(r=!0):(i=!0,setTimeout(function(){i=!1,r&&(o.apply(a,n),r=!1)},t),void e.apply(a,n))}},falseFn:function(){return!1},formatNum:function(e,t){var a=Math.pow(10,t||5);return Math.round(e*a)/a},splitWords:function(e){return e.replace(/^\s+|\s+$/g,"").split(/\s+/)},setOptions:function(e,t){return e.options=L.extend({},e.options,t),e.options},getParamString:function(e,t){var a=[];for(var i in e)e.hasOwnProperty(i)&&a.push(i+"="+e[i]);return(t&&t.indexOf("?")!==-1?"&":"?")+a.join("&")},template:function(e,t){return e.replace(/\{ *([\w_]+) *\}/g,function(e,a){var i=t[a];if(!t.hasOwnProperty(a))throw new Error("No value provided for variable "+e);return i})},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},emptyImageUrl:"data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs="},function(){function getPrefixed(e){var t,a,i=["webkit","moz","o","ms"];for(t=0;t<i.length&&!a;t++)a=window[i[t]+e];return a}function timeoutDefer(e){var t=+new Date,a=Math.max(0,16-(t-lastTime));return lastTime=t+a,window.setTimeout(e,a)}var lastTime=0,requestFn=window.requestAnimationFrame||getPrefixed("RequestAnimationFrame")||timeoutDefer,cancelFn=window.cancelAnimationFrame||getPrefixed("CancelAnimationFrame")||getPrefixed("CancelRequestAnimationFrame")||function(e){window.clearTimeout(e)};FM.Util.requestAnimFrame=function(e,t,a,i){return e=L.bind(e,t),a&&requestFn===timeoutDefer?void e():requestFn.call(window,e,i)},FM.Util.cancelAnimFrame=function(e){e&&cancelFn.call(window,e)},FM.Util.replaceAll=function(e,t,a){return e.replace(new RegExp(t,"g"),a)},FM.Util.parseLayerRequest=function(layer){var layerValues=eval(layer),layerRequest="";return $.each(layerValues,function(e,t){layerRequest+="&"+e+"="+t}),layerRequest},FM.Util.randomID=function(){var e=Math.random().toString(36).substring(7);return(e+Date.now()).toLocaleLowerCase()},FM.Util.fire=function(e,t,a){var i=document.createEvent("CustomEvent");i.initCustomEvent(t,!0,!0,a),e.dispatchEvent(i)},FM.Util.on=function(e,t,a,i){e.addEventListener(t,i,!1)}}(),FM.extend=FM.Util.extend,FM.bind=FM.Util.bind,FM.stamp=FM.Util.stamp,FM.setOptions=FM.Util.setOptions,FM.loadModuleLibs=FM.Util.loadModuleLibs,FM.initializeLangProperties=FM.Util.initializeLangProperties,FM.UIUtils={loadingPanel:function(e,t){var a="25px";t?document.getElementById(e).innerHTML="<div class='fm-loadingPanel' style='height:"+a+"'></div>":document.getElementById(e).innerHTML="<div class='fm-loadingPanel'></div>"}},FM.WMSUtils=FM.Class.extend({_divID:"",_dropdowndID:"",_outputID:"",_fenixMap:"",_wmsServers:"",_mapID:"",_lang:"EN",WMSCapabilities:function(e,t,a,i,r){this._divID=e,this._dropdowndID=e+"-dropdown",this._outputID=t,this._fenixmap=a,this._wmsServers=i,r&&(this._lang=r),this._createWMSDropDown(this._wmsServers,this._divID,this._dropdowndID,this._outputID,a)},_createWMSDropDown:function(e,t,a,i,r){var o='<select id="'+a+'" style="width:200px;" data-placeholder="'+$.i18n.prop("_selectaWMSServer")+'" class="">';o+='<option value=""></option>';for(var n=0;n<e.length;n++)o+='<option value="'+e[n].url+'">'+e[n].label+"</option>";o+="</select>",$("#"+t).empty(),$("#"+t).append(o);try{$("#"+a).chosen({disable_search_threshold:6,width:"100%"})}catch(l){}var s=this;$("#"+a).change({},function(e){s._createWMSOutputRequest(i,r,$(this).val())})},_createWMSOutputRequest:function(e,t,a){$("#"+e).empty(),FM.UIUtils.loadingPanel(e,"30px");var i=FMCONFIG.BASEURL_MAPS+FMCONFIG.MAP_SERVICE_WMS_GET_CAPABILITIES;i+=i.indexOf("?")>0?"&":"?",i+="SERVICE=WMS",i+="&VERSION=1.1.1",i+="&request=GetCapabilities",i+="&urlWMS="+a;var r=this;$.ajax({type:"GET",url:i,success:function(i){var o=$.parseXML(i);r._createWMSOutput(e,t,o,a)}})},_createWMSOutput:function(e,t,a,i){$("#"+e).empty(),$(a).find("Layer").each(function(){if($(this).children("Name").text()&&""!=$(this).children("Name").text()){var a={};a.layers=$(this).children("Name").text(),a.layername=$(this).children("Name").text(),a.layertitle=$(this).children("Title").text(),a.layertitle=a.layertitle.replace(/_/g," "),a.layertitle=a.layertitle.replace(/3857/g," "),a.styles=$(this).children("Style").children("Name").text(),a.urlWMS=i,a.srs=t.map.options.crs.code,a.openlegend=!0;var r=FM.Util.randomID(),o=FM.Util.replaceAll(FM.guiController.wmsLoaderLayer,"REPLACE",r);$("#"+e).append(o),$("#"+r+"-WMSLayer-title").append(a.layertitle),$("#"+r+"-WMSLayer-box").on("click",{fenixmap:t,layer:a},function(e){e.data.layer.openlegend=!1;var t=new FM.layer(e.data.layer);e.data.fenixmap.addLayer(t);try{FMPopUp.init({parentID:e.data.fenixmap.id,content:"The Layer <b>"+e.data.layer.layertitle+"</b><br> has been added to the map"})}catch(e){}});var n=t,l=$.extend(!0,{},a),s=new FM.layer(l);try{$("#"+r+"-WMSLayer-box").hoverIntent({over:function(){n.addLayer(s)},out:function(){n.removeLayer(s)},timeout:500})}catch(d){}}})},addWMSServer:function(){},_WMSCapabilities:function(e,t,a){var i=FMCONFIG.BASEURL_MAPS+FMCONFIG.MAP_SERVICE_WMS_GET_CAPABILITIES;i+=i.indexOf("?")>0?"&":"?",i+="SERVICE=WMS",i+="&VERSION=1.1.1",i+="&request=GetCapabilities",i+="&urlWMS="+a;var r=this;$.ajax({type:"GET",url:i,success:function(i){var o=$.parseXML(i);r._createWMSDropwDown(e,t,o,a)}})},_createWMSDropwDown:function(e,t,a,i){FM.Util.randomID();$(a).find("Layer").each(function(){var a=FM.Util.randomID();if($(this).children("Name").text()){var r={};r.layers=$(this).children("Name").text(),r.layername=$(this).children("Name").text(),r.layertitle=$(this).children("Title").text(),r.styles=$(this).children("Style").children("Name").text(),r.urlWMS=i,r.openlegend=!0,$("#"+e).append("<div id='WMSLayer-"+a+"'>ddd"+r.layertitle+" + "+r.styles+" <div>"),r.srs=t.map.options.crs.code,$("#WMSLayer-"+a).click({fenixmap:t,layer:r},function(e){var t=new FM.layer(e.data.layer);e.data.fenixmap.addLayerWMS(t)})}})},WFSCapabilities:function(e,t,a){var i=FMCONFIG.BASEURL_MAPS+FMCONFIG.MAP_SERVICE_WMS_GET_CAPABILITIES;i+=i.indexOf("?")>0?"&":"?",i+="SERVICE=WFS",i+="&VERSION=1.0.0",i+="&request=GetCapabilities",i+="&urlWMS="+a;$.ajax({type:"GET",url:i,success:function(i){var r=$.parseXML(i);FM.WMSUtils._createWMSDropwDown(e,t,r,a)}})},_createWFSDropwDown:function(e,t,a,i){$(a).find("Layer").each(function(){var a=FM.Util.randomID();if($(this).children("Name").text()){$("#"+e).append("<div id='WMSLayer-"+a+"'>"+$(this).children("Title").text()+" + "+$(this).children("Style").children("Name").text()+" <div>");var r={};r.layers=$(this).children("Name").text(),r.layername=$(this).children("Name").text(),r.layertitle=$(this).children("Title").text(),r.style=$(this).children("Style").children("Name").text(),r.urlWMS=i,r.openlegend=!0,r.srs=t.map.options.crs.code,$("#WMSLayer-"+a).click({fenixmap:t,layer:r},function(e){var t=new FM.layer(e.data.layer);e.data.fenixmap.addLayerWMS(t)})}})}}),function(){var e={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",prefix:""},t="webkit moz o ms khtml".split(" ");if("undefined"!=typeof document.exitFullscreen)e.supportsFullScreen=!0;else for(var a=0,i=t.length;a<i;a++)if(e.prefix=t[a],"undefined"!=typeof document[e.prefix+"CancelFullScreen"]){e.supportsFullScreen=!0;break}e.supportsFullScreen&&(e.fullScreenEventName=e.prefix+"fullscreenchange",e.isFullScreen=function(){switch(this.prefix){case"":return document.fullScreen;case"webkit":return document.webkitIsFullScreen;default:return document[this.prefix+"FullScreen"]}},e.requestFullScreen=function(e){return""===this.prefix?e.requestFullscreen():e[this.prefix+"RequestFullScreen"]()},e.cancelFullScreen=function(e){return""===this.prefix?document.exitFullscreen():document[this.prefix+"CancelFullScreen"]()}),"undefined"!=typeof jQuery&&(jQuery.fn.requestFullScreen=function(){return this.each(function(){var t=jQuery(this);e.supportsFullScreen&&e.requestFullScreen(t)})}),window.fullScreenApi=e}(),FM.DEPENDENCIES={FENIX_REPOSITORY:"fenixrepo.fao.org/cdn/js",fenixmap:{js:["js/FENIXMap.js","js/core/Class.js","js/core/Util.js","js/core/hashmap.js","js/map/config/CONFIG.js","js/map/config/DEPENDENCIES.js","js/map/Map.js","js/map/controller/MapController.js","js/map/layer/Layer.js","js/map/layer/TileLayer.js","js/map/constants/TILELAYER.js","js/map/gui/gui-controller.js","js/map/gui/gui-map.js","js/core/fullscreen.js","js/core/UIUtils.js"],css:["http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css","http://fenixrepo.fao.org/cdn/js/jquery.power.tip/1.2.0/css/jquery.powertip.css","http://hqlprfenixapp2.hq.un.fao.org:13000/repository/js/jquery.pageslide/2.0/jquery.pageslide.min.css","css/fenix-map.css"]},geocoder:{js:["http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.geocoder/1.0/Control.OSMGeocoder.js"],css:["http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.geocoder/1.0/Control.OSMGeocoder.css"]},geosearch:{js:["http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.geosearch/1.0/l.control.geosearch.js","http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.geosearch/1.0/l.geosearch.provider.openstreetmap.js"],css:["http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.geosearch/1.0/l.geosearch.css"]},mouseposition:{js:["http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.mouseposition/1.0/L.Control.MousePosition.js"],css:["http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.mouseposition/1.0/L.Control.MousePosition.css"]},drawcontrol:{js:["http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.draw/1.0/leaflet.draw.js"],css:["http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.draw/1.0/leaflet.draw.css"]},exportplugin:{js:["http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.export/1.0/export.js"],css:["http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.export/1.0/export.css"]},controlloading:{js:["http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.control.loading/1.0/Control.Loading.js"],css:["http://fenixrepo.fao.org/cdn/js/leaflet/plugins/leaflet.control.loading/1.0/Control.Loading.css"]}},FMDEFAULTLAYER={getLayer:function(e,t,a){switch(e.toUpperCase()){case"GAUL0":return FMDEFAULTLAYER._getGAUL("gaul0_faostat_3857_2","adm0_code","the_geom",t,"faost_n",a,"GAUL");case"GAUL0_FAOSTAT":return FMDEFAULTLAYER._getGAUL("gaul0_faostat_3857","faost_code","the_geom",t,"faost_n",a,"FAOSTAT");case"GAUL0_ISO2":return FMDEFAULTLAYER._getGAUL("gaul0_faostat_3857_2","iso2_code","the_geom",t,"faost_n",a,"ISO2");case"GAUL0_ISO3":return FMDEFAULTLAYER._getGAUL("gaul0_faostat_3857_2","iso3_code","the_geom",t,"faost_n",a,"ISO3");case"GAUL0_BOUNDARIES":return FMDEFAULTLAYER._getWMSLayer("gaul0_line_3857");case"GAUL1":return FMDEFAULTLAYER._getGAUL("gaul1_3857","adm1_code","the_geom",t,"adm1_name",a,null);case"GAUL2":return FMDEFAULTLAYER._getGAUL("gaul2_3857","adm2_code","the_geom",t,"adm2_name",a,null)}},_getGAUL:function(e,t,a,i,r,o,n){var l={};return l.layers=e,l.styles="",l.joincolumn=t?t:null,l.joincolumnlabel=r?r:null,l.measurementunit=o?o:null,l.srs="EPSG:3857",l.geometrycolumn=a?a:"",i&&(FMDEFAULTLAYER.joinDefaultPopUp(l),l.joinboundary=n),l},_getWMSLayer:function(e,t,a,i){var r={};return r.layers=e,r.styles=a?a:"",r.srs=i?i:"EPSG:3857",r.urlWMS=t?t:FMCONFIG.DEFAULT_WMS_SERVER,r},joinDefaultPopUp:function(e){var t=e.measurementunit?" "+e.measurementunit:"",a=e.joincolumnlabel?"<div class='fm-popup-join-title'>{{"+e.joincolumnlabel+"}}</div>":"";e.customgfi={content:{en:"<div class='fm-popup'>"+a+"<div class='fm-popup-join-content'>{{{"+e.joincolumn+"}}} <i>"+t+"</i></div></div>",fr:"<div class='fm-popup'>"+a+"{{{"+e.joincolumn+"}}} <i>"+t+"</i></div>",es:"<div class='fm-popup'>"+a+"{{{"+e.joincolumn+"}}} <i>"+t+"</i></div>"},showpopup:!0,output:{show:!0,id:"gfiid"},callback:function(e,t){$("#"+t.outputid).empty(),$("#"+t.outputid).append(e)}}}},FM.TILELAYER={OSM:{url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",title_en:"OSM - OpenStreetMap"},OSM_GRAYSCALE:{url:"http://{s}.www.toolserver.org/tiles/bw-mapnik/{z}/{x}/{y}.png",title_en:"OSM - OpenStreetMap grayscale"},MAPQUEST:{url:"http://otile1.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png",title_en:"MapQuest"},MAPQUEST_NASA_AERIAL:{url:"http://tile21.mqcdn.com/tiles/1.0.0/sat/{z}/{x}/{y}.png",title_en:"MapQuest Aerial"},ESRI_WORLDSTREETMAP:{url:"http://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}.png",title_en:"ESRI - World Street Map"},ESRI_WORLDTERRAINBASE:{url:"http://server.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",title_en:"ESRI - World Terrain Base"},ACETATE_LABELS:{url:"http://a{s}.acetate.geoiq.com/tiles/acetate-labels/{z}/{x}/{y}.png",title_en:"Acetate Labels"},ACETATE_TERRAIN:{url:"http://a{s}.acetate.geoiq.com/tiles/terrain/{z}/{x}/{y}.png",title_en:"Acetate Terrain"},STAMEN_TONER_BACKGROUND:{url:"http://{s}.tile.stamen.com/toner-background/{z}/{x}/{y}.png",title_en:"Stamen"},ESRI_HISTORICAL_MERCATOR:{url:"http://tiles2.arcgis.com/tiles/IEuSomXfi6iB7a25/arcgis/rest/services/World_Globe_1812/MapServer/{z}/{x}/{y}.png",title_en:"ESRI_HISTORICAL_MERCATOR"}},FM.WMSSERVERS={DEFAULT_EXTERNAL_WMS_SERVERS:[{label:"FENIX Crops Area",label_EN:"FENIX",url:"http://fenix.fao.org/demo/fenix/geoserver/earthstat/wms"},{label:"Greenhouse gases Data",label_EN:"FENIX",url:"http://fenix.fao.org/demo/ghg/geoserver/wms"},{label:"DATA.FAO.ORG",label_EN:"data.fao.org WMS Server",url:"http://data.fao.org/maps/wms"},{label:"UNREDD Congo",label_EN:"UNREDD Congo",url:"http://rdc-snsf.org/diss_geoserver/gwc/service/wms"},{label:"Wales OpenData",label_EN:"Wales OpenData",url:"http://inspire.wales.gov.uk/maps/ows"},{label:"Scotland OpenData",label_EN:"Scotland OpenData",url:"http://sedsh127.sedsh.gov.uk/arcgis/services/ScotGov/StatisticalUnits/MapServer/WMSServer"},{label:"Netherlands OpenData",label_EN:"Netherlands OpenData",url:"http://geodata.nationaalgeoregister.nl/ahn2/wcs"},{label:"German OpenData",label_EN:"German OpenData",url:"http://geo.sv.rostock.de/geodienste/verwaltung/wms"},{label:"ENVIRONMENT OpenData",label_EN:"Scotland OpenData",url:"http://lasigpublic.nerc-lancaster.ac.uk/ArcGIS/services/Biodiversity/GMFarmEvaluation/MapServer/WMSServer"},{label:"OpenGeo Demo Server",label_EN:"OpenGeo Demo Server",url:"http://demo.opengeo.org/geoserver/ows"},{label:"Alberts Map Service",url:"http://maps.gov.bc.ca/arcserver/services/Province/albers_cache/MapServer/WMSServer",urlParameters:"service=WMS"},{label:"Cubert Map Service",label_EN:"Cubert",url:"http://portal.cubewerx.com/cubewerx/cubeserv/cubeserv.cgi"},{label:"GP Map Service",label_EN:"gp map service201",url:"http://geoportal.logcluster.org:8081/gp_map_service201/wms"},{label:"Vienna OpenData",label_EN:"Vienna OpenData",url:"http://data.wien.gv.at/daten/wms"},{label:"Vienna OpenData",label_EN:"Vienna OpenData",url:"http://data.wien.gv.at/daten/wms"}]},FM.Map=FM.Class.extend({id:"",suffix:"",mapContainerID:"",tilePaneID:"",map:"",controller:"",plugins:{},options:{url:{},lang:"EN",guiController:{container:null,overlay:!0,baselayer:!0,wmsLoader:!0,enablegfi:!0,layersthumbs:!1},plugins:{fullscreen:!0,zoomcontrol:!0,scalecontrol:!0,legendcontrol:!0,disclaimerfao:!0},baselayers:null,boundaries:null,labels:null,legendOptions:null,zoomToCountry:null,highlightCountry:null,style:{color:"#337ab7",opacity:.8,weight:2,fillColor:"#337ab7",fillOpacity:.1}},mapOptions:{zoomControl:!1,attributionControl:!1,center:[0,0],lat:0,lng:0,zoom:1},initialize:function(e,t,a){this.options=$.extend(!0,{},this.options,t),this.mapOptions=$.extend(!0,{},this.mapOptions,a),FMCONFIG&&(this.options.url=$.extend(!0,{},FMCONFIG,t&&t.url)),FM.initializeLangProperties(this.options.lang);var i=FM.Util.randomID(),r=i+"-container-map",o=i+"-map",n="<div class='fm-map-box fm-box' id='"+r+"'><div>";$(e).length>0?$(e).append(n):$("#"+e).append(n),this.id=o,this.$map=$("#"+r),this.$map.append("<div style='width:100%; height: 100%;' id='"+o+"'><div>"),this.map=new L.Map(this.id,this.mapOptions),this.mapContainerID=r,this.suffix=i,this.setTilePaneID(),this.controller=new FM.mapController(i,this,this.map,this.options.guiController),this.controller.initializeGUI(),this.map._fenixMap=this,this.options.guiController.enablegfi&&this.map.on("click",this.getFeatureInfo,this);(function(){var e=new L.Control;return e.onAdd=function(e){return $("<div  class='fm-swipe' id='"+i+"-swipe'><div style='display:none' class='fm-swipe-handle'id='"+i+"-handle'>&nbsp</div></div>")[0]},e})().addTo(this.map);this.$map.append(FM.Util.replaceAll(FM.guiController.popUpJoinPoint,"REPLACE",i))},initStyles:function(){function e(e){for(var t={},a=document.styleSheets.length-1,i=document.styleSheets[a].rules||document.styleSheets[a].cssRules,r=0;r<i.length;r++)console.log(i[r].selectorText),i[r].selectorText.indexOf(e)>-1&&(console.log(i[r].selectorText),t[e]||(t[e]=[]),t[e].push(i[r].cssText?i[r].cssText:i[r].style.cssText));return t}$("<h1>PALETTE<h1>").addClass("color-main-light-10").prependTo(this.$map),this.fenixStyles=e(".color-main"),console.log("FMMAP fenixStyles",fenixStyles)},createMap:function(e,t,a){var i=this;this.mapOptions.lat=e||this.mapOptions.lat,this.mapOptions.lng=t||this.mapOptions.lng,this.mapOptions.zoom=a||this.mapOptions.zoom,this.map.setView(new L.LatLng(this.mapOptions.lat,this.mapOptions.lng),this.mapOptions.zoom),this.initializePlugins(),null===this.options.baselayers&&(this.options.baselayers={OSM:FM.TILELAYER.OSM,OSM_GRAYSCALE:FM.TILELAYER.OSM_GRAYSCALE,ESRI_WORLDSTREETMAP:FM.TILELAYER.ESRI_WORLDSTREETMAP,ESRI_WORLDTERRAINBASE:FM.TILELAYER.ESRI_WORLDTERRAINBASE});for(var r in this.options.baselayers){var o=this.options.baselayers[r],n=new FM.layer({layername:r,layertype:"TILE",layertitle:o["title_"+this.options.lang.toLowerCase()],lang:this.options.lang.toUpperCase()}),l=o.url;delete o.url,n.leafletLayer=new L.TileLayer(l,o),this.addTileLayer(n,!0)}return this.options.url.LAYER_BOUNDARIES&&(this.layerBoundaries=new FM.layer({layers:this.options.url.LAYER_BOUNDARIES,layertitle:"Country Boundaries",urlWMS:this.options.url.DEFAULT_WMS_SERVER,opacity:"0.9",lang:"en",hideLayerInControllerList:!0})),this.options.url.LAYER_LABELS&&(this.layerLabels=L.tileLayer("http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="http://cartodb.com/attributions">CartoDB</a>',subdomains:"abcd",maxZoom:19,opacity:.8})),this.highlightLayer=L.geoJson(null,{style:function(e){return i.options.style}}).addTo(this.map),this.options.zoomToCountry&&this.options.zoomToCountry.length>0&&("string"==typeof this.options.zoomToCountry[0]?this.zoomToCountry("iso3",this.options.zoomToCountry):"number"==typeof this.options.zoomToCountry[0]&&this.zoomToCountry("adm0_code",this.options.zoomToCountry)),this.options.highlightCountry&&this.highlightCountry("iso3_code",this.options.highlightCountry),this.options.boundaries&&this.boundariesShow(),this.options.labels&&this.labelsShow(),this},destroyMap:function(){this.map.remove(),this.$map.empty()},setTilePaneID:function(){this.tilePaneID=this.suffix+"-leaflet-tile-pane";var e=document.getElementById(this.id).childNodes,t=e[1].childNodes;$(t[0]).attr("id",this.tilePaneID)},addTileLayer:function(e,t){return t?this.controller.addBaseLayer(e):(this.controller.layerAdded(e),this.map.addLayer(e.leafletLayer)),this.controller.setZIndex(e),this},addLayer:function(e){if(e._fenixmap=this,this.options.legendOptions&&(e.layer.legendOptions=$.extend(e.layer.legendOptions,this.options.legendOptions)),e.layer.layertype)switch(e.layer.layertype){case"JOIN":"SHADED"==e.layer.jointype.toLocaleUpperCase()?this.addShadedLayer(e):"POINT"==e.layer.jointype.toLocaleUpperCase()&&this.addPointLayer(e);break;case"WMS":this.addLayerWMS(e);break;default:this.addLayerWMS(e)}else this.addLayerWMS(e);return this},removeLayer:function(e){return this.controller.removeLayer(e),this},addLayerWMS:function(e){return this.controller.layerAdded(e),this.map.addLayer(e.createLayerWMS()),this.controller.setZIndex(e),this._openlegend(e,!1),this.controller.showHide(e.id,!1),this},addShadedLayer:function(e){e.layerAdded||this.controller.layerAdded(e),this.createShadeLayerRequest(e,e.isadded)},createShadeLayerRequest:function(e,t){t||($("#"+e.id+"-controller-item-getlegend").css("display","inline-block"),$("#"+e.id+"-controller-item-opacity").css("display","block"));var a=this,i=this.options.url.MAP_SERVICE_SHADED;$.ajax({type:"POST",url:i,data:JSON.stringify(e.layer),contentType:"application/json; charset=utf-8",dataType:"json",success:function(i){a._createShadeLayer(e,i,t)}})},_createShadeLayer:function(e,t,a){"string"==typeof t&&(t=$.parseJSON(t)),e.layer.sldurl=t.url,e.layer.urlWMS=this.options.url.DEFAULT_WMS_SERVER,t.geoserverwms&&(e.layer.urlWMS=t.geoserverwms),e.layer.legendHTML=t.legendHTML,e.createLayerWMSSLD(),this._loadLayer(e,a)},_loadLayer:function(e,t){var t=!(null==t||!t);t?e.leafletLayer.redraw():(this.map.addLayer(e.leafletLayer),this.controller.setZIndex(e),e.isadded=!0),this._openlegend(e,t),this.controller.showHide(e.id,t)},reAddLayer:function(e){this.map.addLayer(e.leafletLayer),this.controller.setZIndex(e)},_openlegend:function(e,t){try{e.layer.openlegend&&FM.Legend.getLegend(e,e.id+"-controller-item-getlegend",t)}catch(a){console.war("_openlegend error:"+a)}},addPointLayer:function(e){this.controller.layerAdded(e),this.createPointLayerRequest(e)},createPointLayerRequest:function(e){$("#"+e.id+"-controller-item-getlegend").css("display","none"),$("#"+e.id+"-controller-item-getlegend-holder").slideUp("slow"),$("#"+e.id+"-controller-item-opacity").css("display","none");var t=this,a=this.options.url.MAP_SERVICE_SHADED,i=new RequestHandler;i.open("POST",a),i.setContentType("application/x-www-form-urlencoded"),i.request.onload=function(){t._createPointLayer(e,this.responseText)},i.send(FM.Util.parseLayerRequest(e.layer)),i.request.onerror=function(){if(e.layer.pointsLayers)for(var t=0;t<e.layer.pointsLayers.length;t++)this.map.removeLayer(e.layer.pointsLayers[t])}},_createPointLayer:function(e,t){"string"==typeof t&&(t=$.parseJSON(t)),e.layer.sldurl=t.sldurl,e.layer.urlWMS=t.geoserverwms,e.layer.legendHTML=t.legendHTML,e.layer.pointsJSON=t.pointsJSON,this._refreshPointLayer(e)},_refreshPointLayer:function(e){if(e.layer.pointsLayers)for(var t=0;t<e.layer.pointsLayers.length;t++)this.map.removeLayer(e.layer.pointsLayers[t]);"string"==typeof e.layer.pointsJSON&&(e.layer.pointsJSON=$.parseJSON(e.layer.pointsJSON));var a=this;e.layer.pointsLayers=[];for(var t=0;t<e.layer.pointsJSON.length;t++){var i=new L.LatLng(e.layer.pointsJSON[t].lat,e.layer.pointsJSON[t].lon),r=e.layer.pointsJSON[t].properties;e.layer.pointsJSON[t].properties.measurementunit="",null!=e.layer.measurementuni&&(e.layer.pointsJSON[t].properties.measurementunit=e.layer.measurementunit),null!=e.layer.pointColor&&(r.color=e.layer.pointColor),null!=e.layer.pointFillColor&&(r.fillColor=e.layer.pointFillColor),null!=e.layer.pointFillOpacity&&(r.fillOpacity=e.layer.pointFillOpacity);var o=new L.CircleMarker(i,r).addTo(this.map);o.setRadius(e.layer.pointsJSON[t].radius),o.bindPopup(r.title+" - "+r.value),o.on("mouseover",function(){$("#"+a.suffix+"-popup-join-point-holder").show(),$("#"+a.suffix+"-popup-join-point-text").empty(),$("#"+a.suffix+"-popup-join-point-value").empty(),$("#"+a.suffix+"-popup-join-point-text").append(this.options.title),$("#"+a.suffix+"-popup-join-point-value").append(this.options.value+"  <i>"+e.layer.measurementunit+"</i>")}),o.on("mouseout",function(){$("#"+a.suffix+"-popup-join-point-holder").hide()}),e.layer.pointsLayers.push(o)}},syncOnMove:function(e){FM.MapUtils.syncMapsOnMove(this.map,e)},getFeatureInfo:function(e,t){var a=this,t=t?t:a.controller.selectedLayer;t&&(null!=t.layer.layertype&&"JOIN"==t.layer.layertype?FM.SpatialQuery.getFeatureInfoJoin(t,e.layerPoint,e.latlng,a):FM.SpatialQuery.getFeatureInfoStandard(t,e.layerPoint,e.latlng,a))},invalidateSize:function(){this.map.invalidateSize()},initializePlugins:function(){if(null!=this.options.plugins){var e=this;$.each(this.options.plugins,function(t,a){var i=t.toLowerCase(),r="_add"+i;FM.Plugins[r]&&(e.plugins[i]=FM.Plugins[r](e,a))})}},cloneMap:function(e){var t=this.exportMap(),a=(JSON.stringify(t.layers,function(e,t){return"function"==typeof t?t+"":t}),new FM.Map(e,t.map.options,t.map.mapOptions));return a.createMap(),a.createMapFromJSON(t),a},createMapFromJSON:function(e){this.loadOverlays(e.layers.overlays)},exportMap:function(){var e={};return e.map=this._getMapOptions(),e.layers=this._getMapLayers(),e},exportMapToJSONFile:function(){var e=this.exportMap(),t=FM.Util.randomID(),a="data:application/octet-stream;filename=mapview-"+t+".fnx,"+encodeURIComponent(JSON.stringify(e)),i=window.open(a,"mapview-"+t+".fnx");i.focus()},_getMapOptions:function(){return{options:$.extend(!0,{},this.options),plugins:$.extend(!0,{},this.plugins),mapOptions:$.extend(!0,_getCurrentMapOptions,this.mapOptions)}},_getMapLayers:function(){return{overlays:this.controller.exportOverlays()}},loadOverlays:function(e){for(var t=0;t<e.length;t++)this.addLayer(new FM.layer(e[t]))},zoomTo:function(e,t,a){FM.MapUtils.zoomTo(this,e,t,a)},zoomToCountry:function(e,t){FM.MapUtils.zoomToCountry(this,e,t)},getSLDfromCSS:function(e,t){FM.MapUtils.getSLDfromCSS(e,t,this.options.url.CSS_TO_SLD)},labelsShow:function(){this.layerLabels.addTo(this.map).bringToFront()},labelsHide:function(){this.map.removeLayer(this.layerLabels)},boundariesShow:function(){this.addLayer(this.layerBoundaries)},boundariesHide:function(){this.removeLayer(this.layerBoundaries)},highlightCountry:function(e,t){e=e||"iso3_code";var a=this,i=this.options.url.DEFAULT_WMS_SERVER+"/ows";a.highlightLayer.clearLayers();for(var r in t){var o={service:"WFS",version:"1.0.0",request:"GetFeature",typeName:"fenix:gaul0_bounds",maxFeatures:50,outputFormat:"text/javascript",format_options:"callback: getJson",viewparams:e+":"+t[r]},n=L.Util.extend(o),l=i+L.Util.getParamString(n);$.ajax({url:l,dataType:"jsonp",jsonpCallback:"getJson",success:function(e){a.highlightLayer.addData(e),a.highlightLayer.bringToFront()}})}}}),FM.map=function(e,t,a){return new FM.Map(e,t,a)},FM.WCS=function(){var e={url:{}},t=e.url.MAP_SERVICE_PROXY?e.url.MAP_SERVICE_PROXY:"http://fenixapps2.fao.org/maps/rest/service/request",a="1.1.1",i={"1.1.1":"identifiers","2.0":"identifiers"},r=function(e,r){var n=t;n+="?service=wcs",n+=e.version?"&version="+e.version:"&version="+a,n+="&request=DescribeCoverage",n+="&"+i[a]+"="+e.layername,n+="&urlWMS="+e.url,$.ajax({type:"GET",url:n,success:function(e){o(e,r)},error:function(){console.log("WCS error getDescription() REQUEST")}})},o=function(e,t){var a="TODO: parse XML if there are useful information";t&&t(a)};return{getDescription:r,getVersion:function(){return a}}}(),FM.WFS=function(e){var e={url:{}},t=e.url.BASEURL_MAPS?e.url.MAP_SERVICE_PROXY:"http://fenixapps2.fao.org/maps/rest/service/request",a="1.1.0",i={"1.1.0":"typeName","2.0":"typeNames"},r=function(e,r){var n=t;n+="?SERVICE=WFS",n+=e.version?"&VERSION="+e.version:"&VERSION="+a,n+="&request=DescribeFeatureType",n+="&"+i[a]+"="+e.layername,n+="&urlWMS="+e.url,$.ajax({type:"GET",url:n,success:function(e){o(e,r)},error:function(){console.log("WFS error getDescription() REQUEST")}})},o=function(e,t){var a=$.parseXML(e),i=$(a),r=[];i.find("xsd\\:sequence xsd\\:element").each(function(){r.push({name:$(this).attr("name"),type:$(this).attr("type")})}),t&&t(r)},n=function(e,r){var o=t;o+="?SERVICE=WFS",o+=e.version?"&VERSION="+e.version:"&VERSION="+a,o+="&request=GetFeature",o+="&"+i[a]+"="+e.layername,o+=e.propertyname?"&propertyname="+e.propertyname:"",o+=e.sortby?"&sortby="+e.sortby:"",o+="&outputFormat=json",o+="&urlWMS="+e.url,$.ajax({type:"GET",url:o,success:function(e){r&&r(e)},error:function(){console.log("WFS error getDescription() REQUEST")}})};return{getFields:r,getFieldsValues:n,getVersion:function(){return a}}}(),FM.LayerUtils={setLayerOpacity:function(e,t){e.leafletLayer&&e.leafletLayer.setOpacity(t),e.layer.opacity=t},filterLayerMinEqualThan:function(e,t,a){t=FM.LayerUtils.getValuesMinEqualThan(t,a),t.redraw()},filterLayerGreaterEqualThan:function(e,t,a){t=FM.LayerUtils.getValuesGreaterEqualThan(t,a),t.redraw()},filterLayerInBetweenEqualThan:function(e,t,a,i){t=FM.LayerUtils.getValuesInBetweenEqualThan(t,a,i),t.redraw()},filterLayerOuterEqualThan:function(e,t,a,i){t=FM.LayerUtils.getValuesOuterEqualThan(t,a,i),t.redraw()},getValuesMinEqualThan:function(e,t){for("string"==typeof e.layer.defaultdata&&(e.layer.defaultdata=$.parseJSON(e.layer.defaultdata)),
e.layer.joindata=[],i=0;i<e.layer.defaultdata.length;i++)$.each(e.layer.defaultdata[i],function(a,r){r<=t&&e.layer.joindata.push(e.layer.defaultdata[i])});return e.layer.joindata=JSON.stringify(e.layer.joindata),e},getValuesGreaterEqualThan:function(e,t){for("string"==typeof e.layer.defaultdata&&(e.layer.defaultdata=$.parseJSON(e.layer.defaultdata)),e.layer.joindata=[],i=0;i<e.layer.defaultdata.length;i++)$.each(e.layer.defaultdata[i],function(a,r){r>=t&&e.layer.joindata.push(e.layer.defaultdata[i])});return e.layer.joindata=JSON.stringify(e.layer.joindata),e},getValuesInBetweenEqualThan:function(e,t,a){for("string"==typeof e.layer.defaultdata&&(e.layer.defaultdata=$.parseJSON(e.layer.defaultdata)),e.layer.joindata=[],i=0;i<e.layer.defaultdata.length;i++)$.each(e.layer.defaultdata[i],function(r,o){o>=t&&o<=a&&e.layer.joindata.push(e.layer.defaultdata[i])});return e.layer.joindata=JSON.stringify(e.layer.joindata),e},getValuesOuterEqualThan:function(e,t,a){for("string"==typeof e.layer.defaultdata&&(e.layer.defaultdata=$.parseJSON(e.layer.defaultdata)),e.layer.joindata=[],i=0;i<e.layer.defaultdata.length;i++)$.each(e.layer.defaultdata[i],function(r,o){(t&&o<=t||a&&o>=a)&&e.layer.joindata.push(e.layer.defaultdata[i])});return e.layer.joindata=JSON.stringify(e.layer.joindata),e}},FM.Legend={getLegend:function(e,t,a){var i=$.extend({forceLabels:"on",forceRule:"true",dx:"0",dy:"0",mx:"0",my:"0",fontAntiAliasing:"true",fontColor:"0x47576F",bgColor:"0xF9F7F3",border:"false",fontSize:"10"},e.layer.legendOptions);$("#"+t+"-legend-layertitle").empty(),$("#"+t+"-legendtitle").empty(),$("#"+t+"-legendsubtitle").empty(),$("#"+t+"-content").empty(),e.layer.layertitle&&$("#"+t+"-legend-layertitle").append(e.layer.layertitle),e.layer.legendtitle&&$("#"+t+"-legendtitle").append(e.layer.legendtitle),e.layer.legendsubtitle&&$("#"+t+"-legendsubtitle").append(e.layer.legendsubtitle);var r="";if(e.layer.legendHTML)r=e.layer.legendHTML,$("#"+t+"-content").append(r);else{var o=e.layer.urlWMS+"?";o+="&service=WMS&version=1.1.0&REQUEST=GetLegendGraphic&layer="+e.layer.layers+"&Format=image/png",null!=e.layer.style&&""!=e.layer.style&&(o+="&style="+e.layer.style),e.layer.sldurl&&(o+="&sld="+e.layer.sldurl);var n=o;o+="&LEGEND_OPTIONS=";for(var l in i)o+=l+":"+i[l]+";";FM.Legend._loadLegend(o,n,t)}a?$("#"+t+"-holder").is(":visible")&&($("#"+t+"-holder").hide(),$("#"+t+"-holder").slideDown(),e.layer.openlegend=!0):$("#"+t+"-holder").is(":visible")?($("#"+t+"-holder").slideUp(),e.layer.openlegend=!1):($("#"+t+"-holder").slideDown(),e.layer.openlegend=!0),$("#"+t+"-remove").click({id:t+"-holder"},function(t){$("#"+t.data.id).slideUp(),e.layer.openlegend=!1})},_loadLegend:function(e,t,a){var i=new Image;i.name=e,i.src=e;var r='<img id="'+a+'-img" src="'+i.src+'" class="decoded">';i.onload=function(){$("#"+a+"-content").append(r),$("#"+a+"-img").css("width",this.width),$("#"+a+"-img").css("height",this.height)},i.onerror=function(){t?FM.Legend._loadLegend(t,null,a):FM.Legend._nolegend(a)}},_nolegend:function(e){var t='<div class="fm-legend-layertitle">'+$.i18n.prop("_nolegendavailable")+"</div>";$("#"+e+"-content").append(t)}},FM.MapUtils=function(){var e=function(e,t){var a=e.map?e.map:e,i=t.map?t.map:t;a.on("dragend zoomend",function(e){a.getCenter()!=i.getCenter&&a.getZoom()!=i.getZoom&&i.setView(a.getCenter(),a.getZoom())})},t=function(e){},a=function(e,t,a,i){var r=e.options.url.ZOOM_TO_BBOX+t+"/"+a+"/"+i.toString();$.ajax({type:"GET",url:r,success:function(t){e.hasOwnProperty("map")?e.map.fitBounds(t):e.fitBounds(t)}})},i=function(e,t,i){a(e,"country",t,i)},r=function(e,t,a){var i="";return $.ajax({url:a,data:{stylename:e,style:t},async:!1,type:"POST",success:function(e){i=e}}),i},o=function(e,t){var a=L.latLngBounds([[-90,-180],[90,180]]),i=t instanceof L.LatLngBounds?t:a,r=190,o=190,n=i.getSouthWest().lng,l=i.getNorthEast().lng,s=l-n,d=i.getNorthEast().lat,c=i.getSouthWest().lat,p=d-c,u=e.getSize().x,f=e.getSize().y;s<0&&(s+=360),p<0&&(p+=360);var y=Math.round(Math.log(360*u/s/r)/Math.LN2),m=Math.round(Math.log(360*f/p/o)/Math.LN2),h=Math.max(y,m)-1;e.setZoom(h,{animate:!1})};return{syncMapsOnMove:e,exportLayers:t,zoomTo:a,zoomToCountry:i,getSLDfromCSS:r,fitWorldByScreen:o}}(),FM.Plugins={_addzoomcontrol:function(e,t){if(t){var a="string"==typeof e.options.plugins.zoomcontrol?e.options.plugins.zoomcontrol:"bottomright";return new L.Control.Zoom({position:a}).addTo(e.map)}},_addfullscreen:function(e,t){if(t&&window.fullScreenApi&&window.fullScreenApi.supportsFullScreen)return function(){var t="string"==typeof e.options.plugins.zoomcontrol?e.options.plugins.zoomcontrol:"bottomright",a="string"==typeof e.options.plugins.fullscreen?e.options.plugins.fullscreen:t,i=new L.Control({position:a});return i.onAdd=function(t){var a=L.DomUtil.create("div","leaflet-control-fullscreen fm-icon-box-background"),i=L.DomUtil.create("a","fm-icon-sprite fm-btn-icon",a);return L.DomEvent.disableClickPropagation(i).addListener(i,"click",function(){var t=e.options.plugins.fullscreen.id||e.id,a=document.getElementById(t);window.fullScreenApi.isFullScreen(a)?window.fullScreenApi.cancelFullScreen(a):window.fullScreenApi.requestFullScreen(a)},i),a},i}().addTo(e.map)},_addzoomresetcontrol:function(e,t){if(t)return function(){var t="string"==typeof e.options.plugins.zoomcontrol?e.options.plugins.zoomcontrol:"bottomright",a="string"==typeof e.options.plugins.zoomresetcontrol?e.options.plugins.zoomresetcontrol:t,i=new L.Control({position:a}),r=e.plugins.zoomcontrol._container;return i.onAdd=function(e){var t=L.DomUtil.create("div","leaflet-control-zoom-reset",r);t.innerHTML="&nbsp;",t.title="Zoom Reset",L.DomEvent.disableClickPropagation(t).addListener(t,"click",function(){e.setView(e.options.center,e.options.zoom)},t);var a=L.DomUtil.create("span");return a.style.display="none",a},i}().addTo(e.map)},_adddisclaimerfao:function(e,t){if(t&&$.powerTip)return function(){var t="string"==typeof e.options.plugins.disclaimerfao?e.options.plugins.disclaimerfao:"bottomright",a=new L.Control({position:t}),i=e.options.lang.toLowerCase();return a.onAdd=function(e){var t=L.DomUtil.create("div","leaflet-control-disclaimer fm-icon-box-background"),a=L.DomUtil.create("a","fm-icon-sprite fm-icon-info",t);return a.title=FM.guiMap["disclaimerfao_"+i],$(a).powerTip({placement:"nw"}),t},a}().addTo(e.map)},_addlayercontroller:function(e,t){t?$("#"+this.suffix+"-controller").show():$("#"+this.suffix+"-controller").hide()},_addgeosearch:function(e,t){if(t&&L.GeoSearch)return new L.Control.GeoSearch({provider:new L.GeoSearch.Provider.OpenStreetMap}).addTo(e.map)},_addgeocoder:function(e,t){if(t&&L.Control.OSMGeocoder)return(new L.Conpluginstrol.OSMGeocoder).addTo(e.map)},_addmouseposition:function(e,t){t&&L.control.mousePosition&&L.control.mousePosition().addTo(e.map)},_addexport:function(e,t){t&&L.Control.Export&&e.map.addControl(new L.Control.Export)},_addprintmodule:function(e,t){if(t&&L.print)var a=L.print.provider({method:"GET",url:"http://hqlprfenixapp1.hq.un.fao.org:10090/geoserver/pdf",autoLoad:!0,dpi:254});var i=L.control.print({provider:a});e.map.addControl(i)},_adddrawcontrol:function(e,t){if(t&&L.Control.Draw){var a=new L.FeatureGroup;e.map.addLayer(a);var i=new L.Control.Draw({draw:{position:"topleft",polygon:{title:"Draw a polygon!",allowIntersection:!1,drawError:{color:"#b00b00",timeout:1e3},shapeOptions:{color:"#bada55"}},circle:{shapeOptions:{color:"#662d91"}}},edit:{featureGroup:a}});e.map.addControl(i),e.map.on("draw:created",function(t){var i=t.layerType,r=t.layer;"marker"===i&&r.bindPopup("A popup!"),l=r,l.layerType=i,a.addLayer(r),e.spatialQuery(r)}),e.map.on("draw:edited",function(e){var t=e.layers,a=0;t.eachLayer(function(e){a++})})}},_addcontrolloading:function(e,t){if(t&&L.Control.loading){var a=L.Control.loading({separate:!0,position:"topright"});e.map.addControl(a)}},_addscalecontrol:function(e,t){if(t&&L.Control.Scale){var a="string"==typeof e.options.plugins.scalecontrol?e.options.plugins.scalecontrol:"topleft";L.control.scale({position:a}).addTo(e.map)}},_addlegendcontrol:function(e,t){if(t)return function(){var t="string"==typeof e.options.plugins.legendcontrol?e.options.plugins.legendcontrol:"topright",a=new L.Control({position:t});return a.onAdd=function(e){var t=L.DomUtil.create("div","leaflet-control-legend");return t},a}().addTo(e.map)}},FM.SpatialQuery={getFeatureInfoJoin:function(e,t,a,i){null==e.layer.customgfi&&FMDEFAULTLAYER.joinDefaultPopUp(e.layer),FM.SpatialQuery.getFeatureInfoStandard(e,t,a,i)},getFeatureInfoStandard:function(e,t,a,i){var r=i.map,o=r.getBounds(),n=r.options.crs.project(o.getSouthWest()),l=r.options.crs.project(o.getNorthEast()),s=n.x+","+n.y+","+l.x+","+l.y,d=r.getSize().x,c=r.getSize().y,p=r.layerPointToContainerPoint(t).x,u=r.layerPointToContainerPoint(t).y;p=new Number(p),p=p.toFixed(0),u=new Number(u),u=u.toFixed(0);var f=i.options.url.MAP_SERVICE_GFI_STANDARD;f+="?SERVICE=WMS",f+="&VERSION=1.1.1",f+="&REQUEST=GetFeatureInfo",f+="&BBOX="+s,f+="&HEIGHT="+c,f+="&WIDTH="+d,f+="&X="+p,f+="&Y="+u,f+="&FORMAT=image/png",f+="&INFO_FORMAT=text/html",""!=e&&null!=e&&(f+="&LAYERS="+e.layer.layers,f+="&QUERY_LAYERS="+e.layer.layers,f+="&STYLES=",f+="&SRS=EPSG:3857",f+="&urlWMS="+e.layer.urlWMS,FM.SpatialQuery.getFeatureInfoJoinRequest(f,"GET",a,r,e))},customPopup:function(e,t,a,i,r){var o='<div class="fm-popup">{{'+r.joincolumnlabel+"}} <br /><b>{{{"+r.joincolumn+"}}} </b> "+r.mu+"</div>";t.content&&t.content[a]&&(o=t.content[a]);var n=this._parseHTML(o);if(n.id.length>0||n.joinid.length>0){var l=$("<div></div>").append(e),s=l.find("table");if(s)return FM.SpatialQuery._customizePopUp(o,n,s,i,r)}},getFeatureInfoJoinRequest:function(e,t,a,i,r){var o=null!=r.layer.lang?r.layer.lang:i.options.lang,n=i,l=r;$.ajax({type:"GET",url:e,success:function(e){if(null!=e){var t=$("#"+n._fenixMap.id).width()-15,i=$("#"+n._fenixMap.id).height()-15,s=new L.Popup({maxWidth:t,maxHeight:i}),d=e;if(l.layer.customgfi){var c=null!=l.layer.joindata?l.layer.joindata:l.layer.data,p=FM.SpatialQuery.customPopup(e,l.layer.customgfi,o,c,r.layer);d=null!=p?p[0]:e}else{var p=FM.SpatialQuery.transposeHTMLTable(e,l.layer.layertitle);d=null!=p?p[0]:e}d=FM.SpatialQuery._checkGeoserverDefaultEmptyOutput(d),l.layer.customgfi?(l.layer.customgfi&&l.layer.customgfi.callback&&l.layer.customgfi.callback(d,l.layer),l.layer.customgfi&&l.layer.customgfi.output&&l.layer.customgfi.output.show&&($("#"+l.layer.customgfi.output.id).empty(),d&&$("#"+l.layer.customgfi.output.id).append(d)),l.layer.customgfi&&l.layer.customgfi.showpopup&&d&&(s.setLatLng(a).setContent(d),n.openPopup(s))):d&&(s.setLatLng(a).setContent(d),n.openPopup(s))}}})},_checkGeoserverDefaultEmptyOutput:function(e){return e},_customizePopUp:function(e,t,a,i,r){for(var o=a.find("tr"),n=$(o[0]).find("th"),l=[],s=[],d=0;d<n.length;d++)for(var c=0;c<t.id.length;c++)if(t.id[c].toUpperCase()==n[d].innerHTML.toUpperCase()){s.push(d);break}if(i)for(var p=[],d=0;d<n.length;d++)for(var c=0;c<t.joinid.length;c++)if(t.joinid[c].toUpperCase()==n[d].innerHTML.toUpperCase()){p.push(d);break}for(var d=1;d<o.length;d++)l.push($(o[d]).find("td"));for(var u=[],c=0;c<l.length;c++){for(var f=e,d=0;d<s.length;d++){var y="{{"+n[s[d]].innerHTML+"}}",m=l[c][s[d]].innerHTML;f=FM.Util.replaceAll(f,y,m)}var h=!1;if(i)for(var d=0;d<p.length;d++){var y="{{{"+n[p[d]].innerHTML+"}}}",m=l[c][p[d]].innerHTML,g=FM.SpatialQuery._getJoinValueFromCode(m,i);g="NA"!==g&&r.decimalvalues?g.toFixed(r.decimalvalues):g,f=FM.Util.replaceAll(f,y,g),"NA"!==g&&(h=!0)}u.push(f)}return u[0]=FM.Util.replaceAll(u[0],"{{measurementunit}}",h?r.measurementunit:""),u},_getJoinValueFromCode:function(e,t){for(var a=parseInt(e)?parseInt(e):null,i="string"==typeof t?$.parseJSON(t):t,r=0;r<i.length;r++)if(i[r][e]||i[r][a])return i[r][e]?i[r][e]:i[r][a];return"NA"},_parseHTML:function(e){var t={};t.id=[],t.joinid=[];for(var a=e.match(/\{\{.*?\}\}/g),i=0;i<a.length;i++)a[i]=FM.Util.replaceAll(a[i],"{{",""),a[i]=FM.Util.replaceAll(a[i],"}}",""),a[i].indexOf("{")>=0?(a[i]=FM.Util.replaceAll(a[i],"{",""),a[i]=FM.Util.replaceAll(a[i],"}",""),t.joinid.push(a[i])):t.id.push(a[i]);return t},transposeHTMLTable:function(e,t){var a=$("<div></div>").append(e),i=a.find("table");if(i){var r=FM.SpatialQuery.transposeHTML(i,t);if(null!=r)return r}return null},transposeHTML:function(e,t){var a=$('<div class="fm-transpose-popup"></div>');e.find("caption");try{a.append(t);for(var i=e.find("tr"),r=$(i[0]).find("th"),o=[],n=1;n<i.length;n++)o.push($(i[n]).find("td"));for(var l=$("<table></table>"),s=$("<tbody></tbody>"),n=0;n<r.length;n++){for(var d="<tr>",c="<td>"+r[n].innerHTML+"</td>",p=0;p<o.length;p++)c+="<td>"+o[p][n].innerHTML+"</td>";d+=c,d+="</tr>",s.append(d)}return a.append(l.append(s))}catch(u){return null}},filterLayerMinEqualThan:function(e,t){FM.LayerUtils.filterLayerMinEqualThan(this,e,t)},filterLayerGreaterEqualThan:function(e,t){FM.LayerUtils.filterLayerGreaterEqualThan(this,e,t)},filterLayerInBetweenEqualThan:function(e,t,a){FM.LayerUtils.filterLayerInBetweenEqualThan(this,e,t,a)},filterLayerOuterEqualThan:function(e,t,a){FM.LayerUtils.filterLayerOuterEqualThan(this,e,t,a)}},FM.LayerSwipe={swipeActivate:function(e,t,a,i){function r(e){e=Math.max(0,Math.min(e,i.getSize().x)),n.style.left=e+"px";var t=i.containerPointToLayerPoint(e,0).x;o.style.clip="rect(-99999px "+t+"px 999999px -99999px)"}e.layer.swipeActive=!0;var o=e.leafletLayer._container,n=document.getElementById(t),l=!1;n.onmousedown=function(){return l=!0,!1},document.onmouseup=function(){l=!1},document.onmousemove=function(e){l&&r(e.x)};e.redraw=function(t){o=e.leafletLayer._container,r(parseInt(n.style.left))},e.mousemoveSwipe=function(t){o=e.leafletLayer._container,r(t.containerPoint.x)},i.on("zoomend",e.redraw),i.on("moveend",e.redraw),i.on("drag",e.redraw),i.on("mousemove",e.mousemoveSwipe);var s=$("#"+a).width();r(s/2)},swipeDeactivate:function(e,t){t.off("zoomend",e.redraw),t.off("moveend",e.redraw),t.off("drag",e.redraw),t.off("mousemove",e.mousemoveSwipe),e.layer.swipeActive=!1;var a=e.leafletLayer._container;a.style.clip="auto"}},FM.MAPController=FM.Class.extend({id:"",suffix:"",_map:"",_fenixMap:"",_guiController:{container:null,overlay:!0,baselayer:!0,layersthumbs:!0},baseLayersMap:"",currentBaseLayer:"",layersMap:"",layersMapZIndexes:"",zIndexBaseLayer:10,zIndex:100,selectedLayer:"",$boxIcons:"",$boxMenu:"",$boxMenuContainer:"",$boxMenuSelected:"",getFeautureInfoLayer:[],initialize:function(e,t,a,i){this._map=a,this._fenixMap=t,this.suffix=e,this.id=e+"-controller",this._guiController=$.extend({},this._guiController,i),this.baseLayersMap=new HashMap,this.layersMap=new HashMap,this.layersMapZIndexes=new HashMap},initializeGUI:function(){var e=this;if(e._guiController&&(e._guiController.overlay||e._guiController.baselayer||e._guiController.wmsLoader)){$("#"+e.id);if(e.$boxMenu=$(FM.Util.replaceAll(FM.guiController.boxMenu,"REPLACE",e.suffix)),e.$boxMenuContainer=e.$boxMenu.find("#"+e.suffix+"-controller-box-content"),e.$boxIcons=$(FM.Util.replaceAll(FM.guiController.boxIcons,"REPLACE",e.suffix)),e.visibleBoxMenu,e._guiController.container){var t=$('<div class="fm-controller-external">').append(e.$boxIcons,e.$boxMenu);t.prependTo(e._guiController.container),e.visibleBoxMenu=!0}else{e.visibleBoxMenu=!1;(function(){var t=new L.Control({position:"bottomleft"});return t.onAdd=function(t){var a=$('<div class="leaflet-control-controller">').append(e.$boxIcons,e.$boxMenu);return L.Browser.touch?L.DomEvent.on(a[0],"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(a[0]),L.DomEvent.on(a[0],"mousewheel",L.DomEvent.stopPropagation)),a[0]},t})().addTo(e._map)}if(e._guiController.overlay&&(e.loadIcon("overlay",e.visibleBoxMenu),e.initializeOverlayDragging()),e._guiController.baselayer&&e.loadIcon("baselayer",e.visibleBoxMenu),e._guiController.wmsLoader){e.loadIcon("wmsLoader",e.visibleBoxMenu);var a=new FM.WMSUtils,i=this.suffix+"-controller-wmsLoader-dropdown",r=this.suffix+"-controller-wmsLoader-content",o=FM.WMSSERVERS.DEFAULT_EXTERNAL_WMS_SERVERS;a.WMSCapabilities(i,r,this._fenixMap,o)}}},loadIcon:function(e,t){var a=e+"Box",i=e+"Icon";t="undefined"!=typeof t&&t,this.$boxMenuContainer.append(FM.Util.replaceAll(FM.guiController[a],"REPLACE",this.suffix)),t===!1?this.$boxMenu.hide():(this.$boxMenu.show(),this.$boxMenuContainer.find(".fm-box-zindex").show());var r=$(FM.Util.replaceAll(FM.guiController[i],"REPLACE",this.suffix));r.appendTo(this.$boxIcons),t===!0&&this.$boxIcons.hide();var o=this,n=$("#"+o.suffix+"-controller-"+e+"-box");$("#"+this.suffix+"-controller-"+e+"Icon").on("click",{$id:n,suffix:this.suffix},function(e){var t=e.data.$id;o.$boxMenu.is(":visible")?o.$boxMenuSelected==t?(o.$boxMenu.slideUp(),t.hide(),o.$boxMenuSelected=""):(t.slideDown(),o.$boxMenuSelected=t):(o.$boxMenuSelected=t,o.$boxMenu.slideDown())}),$("#"+this.suffix+"-controller-"+e+"-remove").on("click",{$id:n,suffix:this.suffix},function(e){var t=e.data.$id,a=e.data.suffix;$("#"+a+"-controller-box").slideUp(),t.hide()})},initializeOverlayDragging:function(){},layerAdded:function(e){var t=this;if(e.layerAdded=!0,e.layer.zindex||(e.layer.zindex=t.zIndex,e.leafletLayer.setZIndex=e.layer.zindex),t.zIndex=t.zIndex+2,!e.layer.hideLayerInControllerList){var a=$(FM.Util.replaceAll(FM.guiController.legend,"REPLACE",e.id)),i=a[0];L.Browser.touch?L.DomEvent.on(i,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(i),L.DomEvent.on(i,"mousewheel",L.DomEvent.stopPropagation)),t._fenixMap.$map.find(".leaflet-control-legend").append(a);var r="#"+t.suffix+"-controller-overlay-content",o="#"+e.id+"-controller-item",n=e.id+"-controller-item",l=FM.Util.replaceAll(FM.guiController.overlay,"REPLACE",e.id);$(r).prepend(l),$("#"+e.id+"-controller-item-box").data("layer",e);$("#"+e.id+"-controller-item-box").index()+1;t._layerGUIOptions(e),t.layersMap.set(e.id,e),t.layersMapZIndexes.set(e.layer.zindex,e.id),$(o+"-title").append(e.layer.layertitle),$(o+"-enabledisable").on("click",{id:e.id},function(e){t.showHide(e.data.id)});var s=1;null!=e.layer.opacity&&(s=e.layer.opacity);var d=$(o+"-getfeatureinfo");e.layer.enablegfi?(d.on("click",{id:e.id},function(e){var a=t.layersMap.get(e.data.id);t.selectedLayer.id==e.data.id?($("#"+t.selectedLayer.id+"-controller-item-getfeatureinfo").removeClass("fm-icon-getfeatureinfo-selected"),t.selectedLayer="",a.layer.defaultgfi=!1):($("#"+t.selectedLayer.id+"-controller-item-getfeatureinfo").removeClass("fm-icon-getfeatureinfo-selected"),$("#"+e.data.id+"-controller-item-getfeatureinfo").addClass("fm-icon-getfeatureinfo-selected"),t.selectedLayer=a,a.layer.defaultgfi=!0)}),e.layer.defaultgfi&&(t.selectedLayer=e,$("#"+t.selectedLayer.id+"-controller-item-getfeatureinfo").removeClass("fm-icon-getfeatureinfo-selected"),$("#"+e.id+"-controller-item-getfeatureinfo").addClass("fm-icon-getfeatureinfo-selected"))):$(o+"-getfeatureinfo").css("display","none");var c=$(o+"-getlegend");null!=e.layer.showlegend&&0==e.layer.showlegend||c.on("click",{id:e.id,idToRender:n+"-getlegend"},function(e){var a=t.layersMap.get(e.data.id);FM.Legend.getLegend(a,e.data.idToRender)}),c.css("display","inline-block"),e.layer.layertype&&"JOIN"==e.layer.layertype&&(null==e.layer.switchjointype||e.layer.switchjointype)&&$(o+"-switchjointype").css("display","inline-block").on("click",{id:e.id},function(e){t.switchJoinType(e.data.id)});var p=$(o+"-swipe");p.on("click",{id:e.id},function(e){var a=t.layersMap.get(e.data.id);null!=a.layer.swipeActive&&a.layer.swipeActive?(FM.LayerSwipe.swipeDeactivate(a,t._map),p.removeClass("fm-icon-swipe-selected")):(FM.LayerSwipe.swipeActivate(a,t._fenixMap.suffix+"-handle",t._fenixMap.suffix+"-map",t._map),p.addClass("fm-icon-swipe-selected"))});var u=$(o+"-zoomtolayer");e.layer.zoomToBBOX&&(u.css("display","inline-block"),u.attr("title",$.i18n.prop("_zoomtolayer")),u.on("click",{id:e.id},function(e){var a=t.layersMap.get(e.data.id);FM.LayerUtils.zoomToLayer(t._map,a.layer)})),e.layer.zoomTo&&(u.css("display","inline-block"),u.attr("title",$.i18n.prop("_zoomtolayer")),u.on("click",{id:e.id},function(e){var a=t.layersMap.get(e.data.id);FM.LayerUtils.zoomToLayer(t._map,a.layer)}));var f=$(o+"-showhide-subicons"),y=$(o+"-subicons");f.on("click",function(e){y.slideToggle("fast"),f.hasClass("fm-icon-up")?(f.removeClass("fm-icon-up"),f.addClass("fm-icon-down")):(f.removeClass("fm-icon-down"),f.addClass("fm-icon-up"))})}},_layerGUIOptions:function(e){e.gui;"JOIN"==e.layer.layertype&&null!=e.layer.gui&&null!=e.layer.gui.nojoinlayerswitch&&e.layer.gui.nojoinlayerswitch&&$("#"+e.id+"-controller-item-switchjointype").css("display","none")},addBaseLayer:function(e){var t=this;e.layer.zindex=this.zIndexBaseLayer,this.zIndexBaseLayer=this.zIndexBaseLayer+2,this.baseLayersMap.set(e.id,e),this.layersMapZIndexes.set(e.layer.zindex,e.id);var a="#"+this.suffix+"-controller-baselayer-content",i="#"+e.id+"-controller-item",r=FM.Util.replaceAll(FM.guiController.baselayer,"REPLACE",e.id);r=FM.Util.replaceAll(r,"MAPID",this._fenixMap.id),$(a).append(r),$(i+"-title").append(e.layer.layertitle),t._guiController.layersthumbs?$("#"+e.id+"-controller-item-baselayer-image").addClass("fm-icon-baselayer-"+e.layer.layername):$("#"+e.id+"-controller-item-baselayer-image").remove(),$(i+"-enabledisable").on("click",{id:e.id},function(e){t.showHide(e.data.id)});var o=1;null!=e.layer.opacity&&(o=e.layer.opacity),$("#"+e.id+"-controller-box-item").on("click",{id:e.id},function(e){var a=e.data.id,i=t.baseLayersMap.get(a);t.removeBaseLayerByID(t.currentBaseLayer.id);var r=t.baseLayersMap.get(t.currentBaseLayer.id);$("#"+r.id+"-controller-box-item").removeClass("fm-controller-box-item-baselayer-content-selected"),$("#"+r.id+"-controller-item-opacity").hide(),$("#"+i.id+"-controller-box-item").addClass("fm-controller-box-item-baselayer-content-selected"),$("#"+i.id+"-controller-item-opacity").show(),t._map.addLayer(i.leafletLayer),t.currentBaseLayer=i,t.setZIndex(i)}),1==this.baseLayersMap.count()&&($(i+"-radio").attr("checked",!0),this._map.addLayer(e.leafletLayer),this.currentBaseLayer=e,$("#"+e.id+"-controller-box-item").addClass("fm-controller-box-item-baselayer-content-selected"),$("#"+e.id+"-controller-item-opacity").show(),t.setZIndex(e))},removeLayer:function(e){null!=e.layer.jointype&&"point"==e.layer.jointype?this.removeLayerPoint(e):this.removeLayerDefault(e)},removeLayerDefault:function(e){this._map.removeLayer(e.leafletLayer),this.layersMap.remove(e.id),this.layersMapZIndexes.remove(e.layer.zindex),$("#"+e.id+"-controller-item-box").remove(),$("#"+e.id+"-controller-item-getlegend-holder").remove()},removeLayerPoint:function(e){for(var t=0;t<e.layer.pointsLayers.length;t++)this._map.removeLayer(e.layer.pointsLayers[t]);this.layersMap.remove(e.id),this.layersMapZIndexes.remove(e.layer.zindex),$("#"+id+"-controller-item-box").remove()},removeBaseLayerByID:function(e){var t=this.baseLayersMap.get(e);this._map.removeLayer(t.leafletLayer)},switchJoinType:function(e){var t=this.layersMap.get(e);"point"==t.layer.jointype.toLowerCase()?($("#"+t.id+"-controller-item-switchjointype").attr("title",$.i18n.prop("_switchtopoint")),this.switchToShaded(e)):"shaded"==t.layer.jointype.toLowerCase()&&($("#"+t.id+"-controller-item-switchjointype").attr("title",$.i18n.prop("_switchtoshaded")),this.switchToPoint(e))},switchToPointswitchToPoint:function(e){var t=this.layersMap.get(e);t.layer.jointype="point",null!=t.leafletLayer&&this._map.removeLayer(t.leafletLayer),this._fenixMap.createPointLayerRequest(t)},switchToShaded:function(e){var t=this.layersMap.get(e);if(t.layer.jointype="shaded",null!=t.layer.pointsLayers)for(var a=0;a<t.layer.pointsLayers.length;a++)this._map.removeLayer(t.layer.pointsLayers[a]);this._fenixMap.createShadeLayerRequest(t)},showHide:function(e,t){try{var a=this.layersMap.get(e);a&&(a.layer.jointype&&"point"==a.layer.jointype.toLowerCase()?this.showHidePointLayer(e):this.showHideLayer(e,t))}catch(i){}},showHidePointLayer:function(e){for(var t=this.layersMap.get(e),a=0;a<t.layer.pointsLayers.length;a++)if(null==t.layer.visibility||t.layer.visibility){t.layer.visibility=!1,$("#"+e+"-controller-item-enabledisable").removeClass("fm-icon-enable"),$("#"+e+"-controller-item-enabledisable").addClass("fm-icon-disable");for(var a=0;a<t.layer.pointsLayers.length;a++)this._map.removeLayer(t.layer.pointsLayers[a])}else{t.layer.visibility=!0,$("#"+e+"-controller-item-enabledisable").removeClass("fm-icon-disable"),$("#"+e+"-controller-item-enabledisable").addClass("fm-icon-enable");for(var a=0;a<t.layer.pointsLayers.length;a++)this._map.addLayer(t.layer.pointsLayers[a])}},showHideLayer:function(e,t){try{var a=this.layersMap.get(e);null==t||t?null!=t&&t||(null==a.layer.visibility||a.layer.visibility?(a.layer.visibility=!1,$("#"+e+"-controller-item-enabledisable").removeClass("fm-icon-enable"),$("#"+e+"-controller-item-enabledisable").addClass("fm-icon-disable"),this._map.removeLayer(a.leafletLayer)):(a.layer.visibility=!0,$("#"+e+"-controller-item-enabledisable").removeClass("fm-icon-disable"),$("#"+e+"-controller-item-enabledisable").addClass("fm-icon-enable"),this._map.addLayer(a.leafletLayer),this.setZIndex(a))):0==a.layer.visibility&&($("#"+e+"-controller-item-enabledisable").removeClass("fm-icon-enable"),$("#"+e+"-controller-item-enabledisable").addClass("fm-icon-disable"),this._map.removeLayer(a.leafletLayer))}catch(i){}},updateZIndex:function(e,t){var a=this.layersMap.get(e);a.layer.zindex=t,a.leafletLayer.setZindex=t;try{document.getElementById(a.id).style.zIndex=t}catch(i){}},setZIndex:function(e){try{var t=document.getElementById(this._fenixMap.tilePaneID).childNodes;for(i=0,len=t.length;i<len;i++)if(t[i]!==this._container){var a=parseInt(t[i].style.zIndex,10);isNaN(a)&&(t[i].style.zIndex=e.layer.zindex,t[i].id=e.id)}}catch(r){}},selectGetFeatureInfoIcon:function(e){for(var t=0;t<this.layersMap.count();t++)this.layersMap._data[t]==e?$("#"+e+"-controller-item-getfeatureinfo").addClass("fm-icon-getfeatureinfo-selected"):$("#"+e+"-controller-item-getfeatureinfo").removeClass("fm-icon-getfeatureinfo-selected")},exportOverlays:function(){var e=[];this.layersMap.forEach(function(t){e.push(t.layer.zindex)}),e=e.sort();for(var t=[],a=0;a<e.length;a++){var i=!1;i||this.layersMap.forEach(function(r){r.layer.zindex==e[a]&&(t.push(r.layer),i=!0)})}var r=$.map(t,function(e){return $.extend(!0,{},e)});return r},exportBaselayers:function(){return null}}),FM.mapController=function(e,t,a,i){return new FM.MAPController(e,t,a,i)},FM.guiController={boxIcons:'<div id="REPLACE-controller-box-icons-container" class="fm-icon-box-background fm-controller-box-icons-container"></div>',boxMenu:'<div class="fm-box-zindex fm-icon-box-background fm-controller-box-icons-container fm-controller-box" id="REPLACE-controller-box"><div id="REPLACE-controller-box-content" class="clearfix"></div></div>',baselayerIcon:'<div class="fm-box-zindex fx-toolbar-map-holder "><div class="fm-icon-sprite fm-baselayers" id="REPLACE-controller-baselayerIcon"><div></div>',baselayerBox:'<div class="fm-box-zindex fx-toolbar-map-holder " id="REPLACE-controller-baselayer-box"><div id="REPLACE-controller-baselayer-title" class="fm-controller-box-title">Baselayers</div><div id="REPLACE-controller-baselayer-remove" class="fm-icon-close-panel-sprite fm-icon-close fm-icon-right"></div><div class="fm-standard-hr"></div><div id="REPLACE-controller-baselayer-content" class="fm-controller-box-content"></div></div>',baselayer:'<div id="REPLACE-controller-box-item" class="fm-box-zindex fx-toolbar-map-holder  fm-controller-box-item-baselayer-content"><div id="REPLACE-controller-item"><div class="fm-controller-box-item-baselayer-image" id="REPLACE-controller-item-baselayer-image"></div><div class="fm-controller-box-item-baselayer-text"><div><label class="fm-controller-box-item-baselayer-text fm-controller-item-title" id="REPLACE-controller-item-title"><input id="REPLACE-controller-item-radio"  class="fm-checkbox-hide" type="radio" name="MAPID" value="REPLACE"><label></div><div style="clear:both"></div><div class="fm-opacity-slider-baselayers" id="REPLACE-controller-item-opacity" style="display:none"></div></div></div></div>',overlayIcon:"<div class='fm-box-zindex fx-toolbar-map-holder '><div class='fm-icon-sprite fm-overlays' id='REPLACE-controller-overlayIcon'></div></div>",overlayBox:'<div class="fm-box-zindex fx-toolbar-map-holder " id="REPLACE-controller-overlay-box"><div id="REPLACE-controller-overlay-title" class="fm-controller-box-title">Selected Layers</div><div id="REPLACE-controller-overlay-remove" class="fm-icon-close-panel-sprite fm-icon-close fm-icon-right"></div><div class="fm-standard-hr"></div><div id="REPLACE-controller-overlay-content" class="fm-controller-box-content"></div></div>',overlay:'<div id="REPLACE-controller-item-box" class="fm-box-zindex fx-toolbar-map-holder  fm-controller-box-item"><div id="REPLACE-controller-item" class="fm-controller-box-header"><div class="fm-controller-box-header-text"><div class="fm-controller-item-title" id="REPLACE-controller-item-title" ></div><div class="fm-icon-right fm-icon-layer-panel-sprite fm-icon-down" id="REPLACE-controller-item-showhide-subicons"></div></div><div style="clear:both"></div><div class="fm-controller-box-icons"><div class="fm-icon-enable" id="REPLACE-controller-item-enabledisable"></div><div class="fm-opacity-slider" style="margin-right:10px;" id="REPLACE-controller-item-opacity"></div></div><div style="clear:both"></div><div class="fm-controller-box-subicons" id="REPLACE-controller-item-subicons" style="display:none;"><div class="fm-icon-layer-subicons-sprite fm-icon-getlegend" id="REPLACE-controller-item-getlegend"></div><div class="fm-icon-layer-subicons-sprite fm-icon-getfeatureinfo" id="REPLACE-controller-item-getfeatureinfo"></div><div class="fm-icon-layer-subicons-sprite fm-icon-switchJoinType" id="REPLACE-controller-item-switchjointype" style="display:none"></div><div class="fm-icon-layer-subicons-sprite fm-icon-zoomto" id="REPLACE-controller-item-zoomtolayer" style="display:none"></div><div class="fm-icon-layer-subicons-sprite fm-icon-swipe" id="REPLACE-controller-item-swipe"></div><div class="fm-icon-layer-subicons-sprite fm-icon-switchJoinType" id="REPLACE-controller-item-joinsettings" style="display:none"></div></div></div></div>',wmsLoaderIcon:"<div class='fm-box-zindex fx-toolbar-map-holder '><div class='fm-icon-sprite fm-wmsloader' id='REPLACE-controller-wmsLoaderIcon'></div></div>",wmsLoaderBox:'<div class="fm-box-zindex fx-toolbar-map-holder " id="REPLACE-controller-wmsLoader-box" style="display:none; min-height:300px;"><div id="REPLACE-controller-wmsLoader-title" class="fm-controller-box-title">WMS Loader</div><div id="REPLACE-controller-wmsLoader-remove" class="fm-icon-close-panel-sprite fm-icon-close fm-icon-right"></div><div class="fm-standard-hr"></div><div class="clear:both"></div><div class="fm-WMSLoaderDropDown" id="REPLACE-controller-wmsLoader-dropdown"></div><div id="REPLACE-controller-wmsLoader-content" class="fm-controller-wmsLoader-content"></div></div>',wmsLoaderLayer:'<div id="REPLACE-WMSLayer-box" class="fm-WMSLayer-box"><div id="REPLACE-WMSLayer-icon" class="fm-controller-box-icon fm-icon-info"></div><div id="REPLACE-WMSLayer-title" class="fm-WMSLayer-title"></div></div>',legend:'<div class="fm-icon-box-background fm-box-legend" id="REPLACE-controller-item-getlegend-holder"><div class="fm-legend-title-content"><div id="REPLACE-controller-item-getlegend-legend-layertitle" class="fm-legend-layertitle"></div><div id="REPLACE-controller-item-getlegend-remove" class="fm-icon-close-panel-sprite fm-icon-close fm-icon-right"></div></div><div class="fm-standard-hr"></div><div id="REPLACE-controller-item-getlegend-legendtitle" class="fm-legendtitle"></div><div id="REPLACE-controller-item-getlegend-legendsubtitle" class="fm-legendsubtitle"></div><div id="REPLACE-controller-item-getlegend-content" ></div></div>',popUpJoinPoint:'<div class="fm-box fm-popup-join-point-holder" id="REPLACE-popup-join-point-holder" style="display:none"><div class="fm-popup-join-point-text" id="REPLACE-popup-join-point-text"></div><div class="fm-popup-join-point-value" id="REPLACE-popup-join-point-value"></div></div>'
},FM.guiMap={disclaimerfao_en:'<div class="fm-disclaimerfao">The designations employed and the presentation of material in the maps  <br>do not imply the expression of any opinion whatsoever on the part of  <br>FAO concerning the legal or constitutional status of any country, <br>territory or sea area, or concerning the delimitation of frontiers.  <br>South Sudan declared its independence on July 9, 2011. <br>Due to data availability, the assessment presented in the map for Sudan  <br>and South Sudan reflects thesituation up to 2011 for the former Sudan.</div>',disclaimerfao_es:"",disclaimerfao_es_styled:'<div class="fm-disclaimerfao-text"></div>',disclaimerfao_fr:"",disclaimerfao_fr_styled:'<div class="fm-disclaimerfao-text"></div>'},FM.Layer=FM.Class.extend({_fenixmap:"",id:"",layer:{styles:"",srs:"EPSG:3857",visibility:!0,format:"image/png",transparent:"TRUE",opacity:1,name:"",tiitle:"","abstract":"",srs:"",LatLonBoundingBox:"",BoundingBox:"",Style:{name:"",title:"","abstract":"",legendurl:{format:"",onlineresource:""}},KeywordList:[],layertitle:"",enablegfi:!0,layertype:"WMS",openlegend:!1,legendOptions:{forceLabels:"on",forceRule:"true",dx:"0",dy:"0",mx:"0",my:"0",fontAntiAliasing:"true",fontColor:"0x47576F",bgColor:"0xF9F7F3",border:"false",fontSize:"15"},switchjointype:!1,lang:"EN"},leafletLayer:"",initialize:function(e,t){this.layer=$.extend(!0,{},this.layer,e),t&&(this.options=t),this.id=FM.Util.randomID(),e.joindata&&(e.defaultdata=e.joindata)},createLayerWMS:function(){var e=this._getWMSParameters();return this.leafletLayer?"WMS"===this.layertype&&this.leafletLayer.setParams(e):(e=this.options?$.extend(!0,{},this.options,e):e,this.leafletLayer=new L.TileLayer.WMS(this.layer.urlWMS,e)),this.leafletLayer},createLayerWMSSLD:function(){var e=this._getWMSParameters();return this.leafletLayer?this.leafletLayer.setParams(e):this.leafletLayer=new L.TileLayer.WMS(this.layer.urlWMS,e),this.leafletLayer},_getWMSParameters:function(){var e={};return e.id=this.id,e.layers=this.layer.name?this.layer.name:this.layer.layers,e.format=this.layer.format,e.transparent=this.layer.transparent.toUpperCase(),e.visibility=this.layer.visibility,e.opacity=this.layer.opacity,e.styles=this.layer.styles,this.layer.style&&(e.styles=this.layer.style),this.layer.sldurl&&(e.sld=this.layer.sldurl),this.layer.cql_filter&&(e.cql_filter=this.layer.cql_filter),this.layer.sld_body&&(e.sld_body=this.layer.sld_body),this.layer.layers=this.layer.layername?this.layer.layername:this.layer.layers,e},redraw:function(e){var t=this;if(t.layer.layertype)switch(t.layer.layertype){case"JOIN":"SHADED"==t.layer.jointype.toLocaleUpperCase()?e?e.addLayer(this):this._fenixmap&&this._fenixmap.addLayer(this):"POINT"==t.layer.jointype.toLocaleUpperCase()&&console.log("TODO: handle redraw point");break;case"WMS":this.createLayerWMS(),this.leafletLayer.redraw();break;default:this.createLayerWMS(),this.leafletLayer.redraw()}},addPointLayer:function(e){e?e.addPointLayer(this):this._fenixmap&&this._fenixmap.addPointLayer(this)},addLayerWMS:function(e){e?e.addLayerWMS(this):this._fenixmap&&this._fenixmap.addLayerWMS(this)},addLayer:function(e){e?e.addLayer(this):this._fenixmap&&this._fenixmap.addLayer(this)},removeLayer:function(e){e?e.removeLayer(this):this._fenixmap&&this._fenixmap.removeLayer(this)},addShadedLayer:function(e){e?e.addShadedLayer(this):this._fenixmap&&this._fenixmap.addShadedLayer(this)}}),FM.layer=function(e,t,a){return new FM.Layer(e,t,a)},FM.TileLayer=FM.Layer.extend({createTileLayer:function(){var e=this.layer.layername?FM.TILELAYER[this.layer.layername]:FM.TILELAYER[this.layer.layers];this.layer.layertype="TILE",this.layer.layertitle=e["title_"+this.layer.lang.toLowerCase()];var t=new L.TileLayer(e.url);return t}}),FM.TileLayer.createBaseLayer=function(e,t){var a={};a.layername=e,a.layers=e,a.layertype="TILE",a.lang=t;var i=new FM.TileLayer(a);return i.leafletLayer=i.createTileLayer(a.layername),i},FM}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}).call(exports,__webpack_require__(2))},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_2__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_3__},function(e,t){e.exports=__WEBPACK_EXTERNAL_MODULE_4__}])});
//# sourceMappingURL=fenix-ui-map.min.js.map